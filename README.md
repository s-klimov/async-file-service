# Асинхронный микросервис хранения файлов

Микросервис помогает работе основного сайта и обслуживает запросы на сохранение и получение файлов. 

## Как установить

Для работы микросервиса нужен Python версии не ниже 3.10.  
Для настройки локального окружения нужно установить Poetry.

```bash
poetry install
```

## Как запустить web-сервер

```bash
poetry run python server.py server.py [-h] --archive_dir ARCHIVE_DIR --database_url DATABASE_URL --chunk CHUNK
```
Параметры:
* archive_dir - путь до папки, где микросервис будет хранить файлы. Путь должен быть существующим.
* database_url - адрес базы данных.  
* chunk - размер "порции", которыми сервис возвращает файлы. 

Занчение параметров может быть предустановлено в файле `settings.ini`.

Получить справку о параметрах:  
```bash
python server.py -h
```

Сервер запустится на порту 8080.

## Использование микросервиса

В микросервисе реализованы два метода:
1. Сохранение файла в сервисе
```
POST http://localhost:8080/files/
Пример заголовка запроса:
    'Host': 'localhost:8080',
    'Content-Disposition': 'attachment;filename=2.jpg',
    'Accept': '*/*',
    'Accept-Encoding': 'gzip, deflate',
    'User-Agent': 'Python/3.10 aiohttp/3.8.4',
    'Content-Type': 'application/octet-stream',
    'Transfer-Encoding': 'chunked'
```
Пример формирования запроса находистя в скрипте `sender.py`

Метод возвращает id, под которым был сохранен файл.
2Получение файла из сервиса
```
GET http://localhost:8080/files/<id файла>/
```

## Консольный скрипт sender.py
Скрипт формирует post-запрос в адрес микросервиса для сохранения в нём файла.  
### Интерфейс командной строки
```bash
python sender.py [-h] [--protocol {http,https}] [--host HOST] [--port PORT] [--url URL] [--chunk_size CHUNK_SIZE] --path PATH
```
* protocol - Протокол файлового сервера
* host - Хост файлового сервера
* port - Порт файлового сервера
* url - Урл для доступа к методу сохранения файла
* chunk_size - Размер порции файла для считывания в ОЗУ, в байтах
* path - Пусть до файла сохраняемого в файловом сервисе

Получить справку о параметрах:  
```bash
python sender.py -h
```

# Цели проекта
Код написан в учебных целях.